<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zigzag Scanline Algorithm for create3: Tutorial</title>
<link rel="icon" href="Asset 1.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<style>
            @media (prefers-color-scheme: light) {
            .light-mode pre {
                background: rgb(248, 248, 248);
            }
        }
            @media (prefers-color-scheme: dark) {
            .dark-mode pre {
                background: #090909; /* Dark background color */
            }
        }
</style>
</head>
<body class="dark-mode light-mode">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Asset 1.png"/></td>
  <td id="projectalign">
   <div id="projectname">Zigzag Scanline Algorithm for create3<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">Implements zigzag coverage algorithm for create3</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('howto.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Tutorial</div></div>
</div><!--header-->
<div class="contents">
    <h3>Firstly, some tools need to be downloaded:</h3>

    <p>Follow the instructions in the link to install <strong>ROS2 Humble</strong>:</p>
    <p><a href="https://docs.ros.org/en/humble/Installation.html">ROS2 Humble Installation</a></p>

    <p>Follow the instructions in the link to install <strong>NAV2</strong>:</p>
    <p><a href="https://navigation.ros.org/getting_started/index.html">NAV2 Installation</a></p>

    <p>Then install <strong>Turtlebot3</strong> with the following command:</p>
    <pre class="light-mode">
    <code>sudo apt install ros-humble-turtlebot3*</code>
    </pre>

    <h3>With all these packages installed, clone this repository, follow the instructions provided in the link below:</h3>
    <p><strong>Create3_examples github repository:</strong> <a href="https://github.com/iRobotEducation/create3_examples/tree/humble">create3_examples</a></p>

    <h3>Verify lidar connection</h3>
    <p>Now make sure your lidar is plugged in and able to transmit messages. You can verify this by checking the topic list in <strong>ROS2</strong> with the following command:</p>
    <pre>
    <code>ros2 topic list</code>
    </pre>
    <p>There should be a topic called <strong>/scan</strong>. If you can't find but your lidar is running this might be a permission issue. Check the serial port of your lidar with this command:</p>
    <pre>
    <code>ls -l /dev|grep ttyUSB</code>
    </pre>
    <p>By default it should be <strong>ttyUSB0</strong>. Now provide read/write permission to this serial port:</p>
    <pre>
    <code>sudo chmod 666 /dev/ttyUSB0</code>
    </pre>

    <h3>Creating the map</h3>
    <p>Next, we need to create a map of the area to be covered. To do this we need to run the following commands:</p>
    <pre>
    <code>ros2 launch create3_lidar_slam sensors_launch.py</code>
    </pre>
    <p>then in a separate terminal:</p>
    <pre>
    <code>ros2 launch create3_lidar_slam slam_toolbox_launch.py</code>
    </pre>
    <p>there may be some warnings and errors upon startup, but you should eventually see the message: “[async_slam_toolbox_node-1] Registering sensor: [Custom Described Lidar]” next, in a third terminal, run:</p>
    <pre>
    <code>ros2 launch turtlebot3_cartographer cartographer.launch.py</code>
    </pre>
    <p>This will cause turtlebot3’s cartographer to launch. This is the software used to map the area using the LiDAR data. With everything still running, in a fourth terminal run:</p>
    <pre>
    <code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code>
    </pre>
    <p>Drive the robot around until the map is satisfactory.</p>

    <h3>Saving the map</h3>
    <p>Once you are satisfied with the map, you’ll need to save the map. To do this, with everything still running, run the following commands:</p>
    <pre>
    <code>mkdir &lt;maps_directory&gt;</code>
    <code>ros2 run nav2_map_server map_saver_cli -f &lt;maps_directory&gt;/&lt;name_of_map&gt;</code>
    </pre>
    <p>For example, if you wanted to store a map named, “my_map” in a folder directory named, “myMaps,” the command to be run would be:</p>
    <pre>
    <code>mkdir myMaps</code>
    <code>ros2 run nav2_map_server map_saver_cli -f myMaps/my_map</code>
    </pre>
    <blockquote>
        <p><strong>NOTE:</strong> You may need to run this command multiple times until the map is successfully saved.</p>
    </blockquote>

    <h3>Launching the map</h3>
    <p>Now that the map was successfully saved, you can now start up nav2 and navigate within the area that you mapped. First, use ctrl + c to kill the process in the terminal for cartographer and teleop_twist. Then run the following command to run nav2. To get nav2 running with the desired map, run:</p>
    <pre>
    <code>ros2 launch turtbot3_navigation2 navigation2.launch.py use_sim_time:=False map:=&lt;map_directory&gt;/&lt;desired_map_name&gt;.yaml</code>
    </pre>
    <blockquote>
        <p><strong>IMPORTANT:</strong> You should append “.yaml” to the end of the name of the desired map. The yaml file contains the parameters for the map.</p>
    </blockquote>

    <h3>Creating waypoints for the robot to follow</h3>
    <p>Now we need to find the proper waypoints to get the robot to move in the desired zigzag pattern.</p>
    <p align="center"><img src="https://github.com/vinzmoke-zoro/Zigzag-Scanline-Algorithm/assets/63388102/3659c54f-aeb8-41d1-8b07-5dbf0355cf06" alt="Zigzag pattern"></p>
    <p>You will need to move the robot to the proper locations. Move the robot to position 1, and then in a new terminal run:</p>
    <pre>
    <code>ros2 topic echo /odom</code>
    </pre>
    <p>This will cause the data being published to odom to be printed in the terminal. It will show us info like the robot current position within the map. It will be constantly updated. To view the data more easily, use ctrl + c to get the updates to stop. Since the robot won’t be moving, we will still have access to the desired data.</p>

    <p><strong>This is what the /odom echo will look like:</strong></p>
    <p align="center"><img src="https://github.com/vinzmoke-zoro/Zigzag-Scanline-Algorithm/assets/63388102/126f0c7d-01b2-4b7c-9529-5c88cd23b4f2" alt="Robot position data"></p>

    <p>We want to take note of the x and y positions. Write these down and make sure to take note of which position this is. If this is position 1, I might write down: “1: (-2.7871, -1.2062, 0)” The third coordinate is the z-coordinate, this will remain a constant 0 for all waypoints. Make sure not to make any of the waypoints too close to the wall. Additionally, make sure to keep the robot out of the cyan area on the map.</p>

    <p><strong>Here is an example of poor robot placement:</strong></p>
    <p align="center"><img src="https://github.com/vinzmoke-zoro/Zigzag-Scanline-Algorithm/assets/63388102/b083d2ce-b40f-4768-88b4-5e638b3993ec" alt="Poor robot placement"></p>

    <p>The robot here is too far into the cyan area, this will cause nav2 to have a hard time making the robot navigate to that point.</p>

    <p><strong>Here is an example of good robot placement:</strong></p>
    <p align="center"><img src="https://github.com/vinzmoke-zoro/Zigzag-Scanline-Algorithm/assets/63388102/098e4b45-1459-4e31-989f-75290e6568ff" alt="Good robot placement"></p>

    <p>This placement is much better. The robot is just barely touching the cyan area and majority of the robot is in the purple area. The farther away from the cyan, the better.</p>

    <h3>Cloning the repository and building the package:</h3>

    <p>Once the waypoints are all taken note of, clone this repository into a workspace if you haven't already. you can edit the script named, “create3_simple_zigzag” Go to the <strong>src</strong> directory in <strong>your_ws</strong> and launch the folder in VS code:</p>
    <pre>
    <code>cd your_ws/src</code>
    <code>code .</code>
    </pre>
    <p>this will pull VS Code. You may need to download VS Code. Once in VS Code, use the bar on the left to navigate to the create3_simple_zigzag file. Just above the call to nav.followwaypoints, add your waypoints using the template.</p>

    <p><strong>A complete algorithm may look like:</strong></p>
    <p align="center"><img src="https://github.com/vinzmoke-zoro/Zigzag-Scanline-Algorithm/assets/63388102/f7a240d9-57d9-4907-8f39-2405b062bad4" alt="Complete algorithm"></p>

    <p>The final waypoint will make the robot return to the origin of the map.</p>
    <blockquote>
        <p><strong>IMPORTANT:</strong> make sure to use 0.0 instead of just 0 for the x- and y-coordinates. It does matter for the z-coordinate.</p>
    </blockquote>

    <p>Once the those are taken care of go back to the root directory which is <strong>your_ws</strong>:</p>
    <pre>
    <code>cd ..</code>
    </pre>
    <p>Then build and source the package:</p>
    <pre>
    <code>colcon build --symlink-install</code>
    <code>source ~/your_ws/install/setup.bash</code>
    </pre>
    <p>Now to run the script, keep the <strong>sensors</strong>, the <strong>slam_toolbox</strong>, and <strong>nav2</strong> running. With all these processes running, run the script:</p>
    <pre>
    <code>ros2 run create_controller create3_simple_zigzag</code>
    </pre>
    <p>the robot will now follow the waypoints that you put into the script.</p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
